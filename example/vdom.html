<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>vdom</title>
    <style>
        .remove {
            text-decoration: line-through;
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <script src="lib/snabbdom.js"></script>
    <script src="../dist/vo.js"></script>
    <script>
        var { h, patch } = snabbdom;

        var data = {
            list: [
                { message: 'some item', remove: false },
                { message: 'other item', remove: true }
            ]
        };
        
        var app = document.querySelector('#app');

        var ob = vo.proxy(data).watch(render, (newVal, val) => {
            if (val) {
                patch(val, newVal);
            } else {
                patch(app, newVal);
            }
        }, true);

        function render() {
            let list = this.list;

            return (
                h('div', [
                    h('p', { on: { click: create(list) } }, 'new item'),
                    h('ul', list.map((item) => {
                        return (
                            h('li', { on: { click: toggle(item) } }, [
                                h('input', { attrs: { type: 'checkbox' }, props: { checked: item.remove }}),
                                h('span', { class: { remove: item.remove } }, item.message)
                            ])
                        );
                    }))
                ])
            );
        }

        function create(list) {
            return function() {
                list.push({ message: 'extra item', remove: false });
            };
        }

        function toggle(item) {
            return function () {
                item.remove = !item.remove;
            };
        }
    </script>
</body>
</html>